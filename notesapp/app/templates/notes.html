{% block stylesheet %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='notes.css') }}">
{% endblock %}


{% block content %}
  <div class="note-container">
    <div class="header-container">
      <button id="back">back</button>
      <a href="{{ url_for('home') }}">StickyNotes!</a>
    </div>
    <button id="create-note" class="create-note">Create Note</button>
    <form action="" method="post" class="note-form" style="display: none;">
      {{ form.hidden_tag() }}

      <div>
        {{ form.title.label(class='form-label') }} 
        {{ form.title }}
        {% for error in form.title.errors %}
          <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
      </div>

      <div>
        {{ form.note.label(class='form-label') }}
        {{ form.note(cols=32, rows=12) }}
        {% for error in form.note.errors %}
        <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
      </div>

      <div class="color-menu">
        {{ form.color.label(class='form-label') }}
        {{ form.color }}
        {% for error in form.color.errors %}
        <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
      </div>

      {{ form.submit }}
      <button type="button" id="cancel-button" class="cancel-btn">Cancel</button>
    </form>
    {{ ckeditor.load() }}
  </div>

  <div class="clearfix">
    {% for note in posts %}
    <div class="sticky-note" style="background-color: {{ note.color }};">
      <div class="note-actions">
        <a href="{{ url_for('edit_note', note_id=note.id) }}" class="edit-btn">Edit</a>
        <form action="{{ url_for('delete_note', note_id=note.id) }}" method="post">
          <button class="delete-btn" type="submit" onclick="return confirm('Are you sure you want to delete this note?');">Delete</button>
        </form>
      </div>
      <p class="note-title">{{ note.title }}</p>
      <p class="note-content">{{ note.body|safe }}</p>
      <p class="note-details">
        Note ID: {{ note.id }} <br>
        {{ note.timestamp.strftime('%Y/%m/%d %H:%M:%S') }}
      </p>
    </div>
    {% endfor %} 
  </div>
  
{% block scripts %}
<script>
  CKEDITOR.replace('note', {
    toolbar: [
        { name: 'clipboard', items: ['Undo', 'Redo'] },
        { name: 'styles', items: ['Format', 'FontSize'] },
        { name: 'basicstyles', items: ['Bold', 'Italic', 'Underline', 'Strike', 'Subscript', 'Superscript'] },
        { name: 'links', items: ['Link', 'Unlink'] },
        { name: 'insert', items: ['Image', 'Table', 'HorizontalRule', 'SpecialChar'] },
        { name: 'paragraph', items: ['NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote'] }
      ],
      removeButtons: '',
  });
  document.addEventListener('DOMContentLoaded', function() {
    const backButton = document.getElementById('back');
    const createNoteButton = document.getElementById('create-note');
    const cancelButton = document.getElementById('cancel-button');
    const noteForm = document.querySelector('.note-form');
    const formModified = false;

    backButton.addEventListener('click', () => {
      window.location.href = "{{ url_for('home') }}"
    })

    createNoteButton.addEventListener('click', function() {
      noteForm.style.display = 'block';
      createNoteButton.style.display = 'none';
    });

    cancelButton.addEventListener('click', function() {
      noteForm.style.display = 'none';
      createNoteButton.style.display = 'block';
    });

    noteForm.addEventListener('change', function() {
        formModified = true;
    });

    cancelButton.addEventListener('click', function(event) {
        event.preventDefault(); 
        if (formModified) {
            var confirmLeave = confirm('You have unsaved changes. Are you sure you want to discard them?');
            if (confirmLeave) {
                window.location.href = "{{ url_for('notes') }}";
            }
        } else {
            window.location.href = "{{ url_for('notes') }}"; 
        }
    });
  }); 
</script>
{% endblock %}
{% endblock %}

